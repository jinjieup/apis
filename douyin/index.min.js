var api_url = "https://www.mxnzp.com/api/douyin/video";
var code = "";

var app_id = api.id;
var app_secret = api.secret;

window.onload = function(){
  $.ajax({
    url: saying_url,
    success: function (result) {
      $("#saying").text(result);
    },
  });
}

function clear_info() {
  document.getElementById("dy_url").value = "";
}

function get_link() {
  var link_after = document.getElementById("dy_url").value;
  if (link_after == "") {
    alert("链接为空！请检查后再提交！");
    console.log("User enteres empty link!");
  } else if (link_after != "") {
    code = "";
    var origin_url = link_after;
    console.log("origin link: " + origin_url);
    var data_url = window.btoa(unescape(encodeURIComponent(origin_url)));
    console.log("base64 link address: " + data_url);
    $.ajax({
      type: "GET",
      url: api_url,
      data: {
        url: data_url,
        app_id: app_id,
        app_secret: app_secret,
      },
      dataType: "json",
      success: function (e) {
        if (e.msg == "视频解析失败") {
          alert("解析失败！请检查视频链接后重新解析！");
          console.warn("Video Load Failed!");
        } else if (e.msg == "数据返回成功！") {
          console.log("Video Load SuccessFully!");
          console.log("Video Title: " + e.data.title);
          console.log("Video Cover Url: " + e.data.cover);
          console.warn("Video Download Link: " + e.data.url);
          code += `<div class="card mb-3" style="max-width: 720px;display: block;margin: auto;">
              <div class="row g-0">
                <div class="col-md-4">
                  <img src="${e.data.cover}" class="img-fluid rounded-start" alt="...">
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title">${e.data.title}</h5>
                    <p class="card-text">清晰度：${e.data.accept}</p>
                    <p class="card-text">尺寸：${e.data.width}x${e.data.height}</p>
                    <p class="card-text">时长：${e.data.durationFormat}</p>
                    <a class="btn btn-primary" href="${e.data.url}" style="display: block;margin: auto;">下载视频</a>
                  </div>
                </div>
              </div>
            </div>`;
          $("#card_show").html("");
          document.getElementById("card_show").innerHTML = code;
        } else {
          alert("未知错误！建议检查网络连接后刷新网页！");
          console.log("Unknown Failed!");
        }
      },
    });
  }
}
