var post_url = "https://www.mxnzp.com/api/news/details";
var id = null;

var img_list = "";
var img_btn = "";
var img_show = "";
var title_show = "";
var cover_img = "";
var source = "";
var post_t = "";
var detail_show = "";

var app_id = api.id;
var app_secret = api.secret;

window.onload = function () {
  $.ajax({
    url: saying_url,
    success: function (result) {
      $("#saying").text(result);
    },
  });
  get_info();
};

function get_info() {
  id = window.location.search.split("=");
  if ((post_id = null)) {
    alert("非合法进入方式！");
    console.warn("The Wrong Way get into this page!");
    window.open("https://tool.jinjieup.tk/news", "_self");
  } else {
    $.ajax({
      type: "GET",
      url: post_url,
      data: {
        newsId: id[1],
        app_id: app_id,
        app_secret: app_secret,
      },
      dataType: "json",
      success: function (e) {
        img_list = "";
        if (e.code == "0") {
          alert("解析失败！建议重新选择新闻！");
          console.warn("Details Load Failed!");
        } else if (e.code == "1") {
          console.log("Detail Load SuccessFully!");
          console.log("News Title: " + e.data.title);
          if (e.data.cover == "") {
            document.getElementById("cover_image").src = "https://tool.jinjieup.tk/images/no_image.jpg";
          } else {
            document.getElementById("cover_image").src = e.data.cover;
          }
          title_show = e.data.title;
          if (e.data.source == "") {
            source = `<div class="col-sm-6 content-subtitle">未知来源</div>`;
          } else {
            source = `<div class="col-sm-6 content-subtitle">来自于 ${e.data.source}</div>`;
          }
          if (e.data.ptime == "") {
            post_t = "";
          } else {
            post_t = `<div class="col-sm-6 content-subtitle">发表于 ${e.data.ptime}</div>`;
          }
          if (e.data.images == "") {
            img_show += `
            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="true">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="../images/no_image.jpg" class="d-block img-list" alt="...">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>`;
          } else {
            for (let index = 0; index < e.data.images.length; index++) {
              img_list += ``;
              img_btn += ``;
              if (index == "0") {
                img_list += `
                          <div class="carousel-item active">
                  <img src="${e.data.images[index].imgSrc}" class="d-block img-list" alt="...">
                </div>`;
              } else {
                img_list += `<div class="carousel-item">
                <img src="${e.data.images[index].imgSrc}" class="d-block img-list" alt="...">
              </div>`;
              }
              img_btn += `<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="${index}" class="active" aria-current="true" aria-label="Slide ${index+1}"></button>`;
            }
            img_show +=
              `<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="true">
              <div class="carousel-indicators">` +
              img_btn +
              `</div>
              <div class="carousel-inner">` +
              img_list +
              `</div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>`;
          }
          detail_show = source + post_t;
          $("#news_title").html("");
          document.getElementById("news_title").innerHTML = title_show;
          $("#news_images").html("");
          document.getElementById("news_images").innerHTML = img_show;
          $("#content_body").html("");
          document.getElementById("content_body").innerHTML = e.data.content;
          $("#post_detail").html("");
          document.getElementById("post_detail").innerHTML = detail_show;
        } else {
          alert("未知错误！建议检查网络连接后刷新网页！");
          console.log("Unknown Failed!");
        }
      },
    });
  }
}
