var joke_url = "https://www.mxnzp.com/api/jokes/list";
var pages = 0;
var app_id = api.id;
var app_secret = api.secret;

var code = '';
window.onload = function(){
  $.ajax({
    url: saying_url,
    success: function (result) {
      $("#saying").text(result);
    },
  });
  jump(1);
}

function jump_btn(){
  var num = document.getElementById("select-num").value;
  jump(num);
}

function jump(page_num){
  code = '';
  $.ajax({
    type: "GET",
    url: joke_url,
    data: {
      "page": page_num,
      "app_id": app_id,
      "app_secret": app_secret,
    },
    dataType: "json",
    success: function(result){
      pages = result.data.totalPage;
      const list = result.data.list;
      $("#totalPgNum").text("共有"+result.data.totalPage+"页");
      list.forEach(e => {
        code += `<div class="card joke-card">
        <div class="card-header">
          搞笑段子 - 第${page_num}页
        </div>
        <div class="card-body">
          <blockquote class="blockquote mb-0">
            <p>${e.content}</p>
            <footer class="blockquote-footer" style="float: right;"><cite>于${e.updateTime}上传</cite></footer>
          </blockquote>
        </div>
      </div>`
      });
      // document.getElementById("joke").innerHTML = '';
      $('#joke').html("");
      document.getElementById("joke").innerHTML = code;
    }
  })
}

function change(){
  var a = Math.round(Math.random()*(pages-1))+1;
  console.log("Random page number selector: " + a);
  document.getElementById("select-num").value = a;
  document.getElementById("jump_btn").click();
  document.getElementById("select-num").value = '';
}