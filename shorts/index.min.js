var api_url = "https://www.mxnzp.com/api/shortlink/create";
var code = "";

var app_id = api.id;
var app_secret = api.secret;

window.onload = function(){
  $.ajax({
    url: saying_url,
    success: function (result) {
      $("#saying").text(result);
    },
  });
  notice();
}

function notice(){
  new bootstrap.Toast(document.querySelector('#notice')).show();
}

function check_link() {
  var link = document.getElementById("input_label").value;
  if (link == "") {
    alert("链接输入为空！请填写后再次检查！");
    console.warn("empty link entered!");
  } else if (link != "") {
    window.open(link, "_blank");
    console.log("User check link: " + link);
  } else {
    alert("未知错误！建议刷新后重试！");
    console.warn("Unknown Failed!");
  }
}

function create_link() {
  var origin_link = document.getElementById("input_label").value;
  if (origin_link == "") {
    alert("链接输入为空！请填写后再次检查！");
    console.warn("empty link entered!");
  } else if (origin_link != "") {
    console.log("Origin link address: " + origin_link);
    var origin_link_data = window.btoa(unescape(encodeURIComponent(origin_link)));
    console.log("Origin Link Encode: "+origin_link_data);
    $.ajax({
      type: "GET",
      url: api_url,
      data: {
        url: origin_link_data,
        app_id: app_id,
        app_secret: app_secret,
      },
      dataType: "json",
      success: function (e) {
        if (e.code == 1) {
          code = "";
          new bootstrap.Toast(document.querySelector('#success_toast')).show();
          console.log("Short Link Load SuccessFully!");
          console.log("Origin Link: " + e.data.url);
          console.log("Shorten Link: " + e.data.shortUrl);
          code += `<div class="card border-info mb-3">
                    <div class="card-header">短链接生成成功！</div>
                    <div class="card-body">
                      <div class="container" style="padding: 0.5rem;">
                        <div class="row">
                          <div class="col-sm-9">
                            <h5 class="card-title">原始链接</h5>
                            <input type="text" class="form-control" value="${e.data.url}" placeholder="Origin Link" id="origin" aria-label="link">
                          </div>
                          <div class="col-sm-3">
                            <div class="container" style="display: inline;">
                              <div class="row">
                                <div class="col">
                                  <a href="#subtitle" onclick="origin_jump()" class="btn btn-primary jump-btn">
                                    <i class="bi bi-box-arrow-up-right"></i>
                                  </a>
                                </div>
                                <div class="col">
                                  <a href="#subtitle" onclick="origin_copy()" class="btn btn-primary jump-btn">
                                    <i class="bi bi-clipboard-check"></i>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="container" style="padding: 0.5rem;">
                        <div class="row">
                          <div class="col-sm-9">
                            <h5 class="card-title">短链接</h5>
                            <input type="text" class="form-control" value="${e.data.shortUrl}" placeholder="Shorten Link" id="shorten" aria-label="link">
                          </div>
                          <div class="col-sm-3">
                            <div class="container" style="display: inline;">
                              <div class="row">
                                <div class="col">
                                  <a href="#subtitle" onclick="shorten_jump()" class="btn btn-primary jump-btn">
                                    <i class="bi bi-box-arrow-up-right"></i>
                                  </a>
                                </div>
                                <div class="col">
                                  <a href="#subtitle" onclick="shorten_copy" class="btn btn-primary jump-btn">
                                    <i class="bi bi-clipboard-check"></i>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>`;
          $("#card_show").html("");
          document.getElementById("card_show").innerHTML = code;
        } else {
          alert("未知错误！建议刷新后重试！");
          console.warn("Unknown Failed! [GET]");
        }
      },
    });
  } else {
    alert("未知错误！建议刷新后重试！");
    console.warn("Unknown Failed!");
  }
}

function origin_jump() {
  console.log("Jump to origin_link");
  var origin_link = document.getElementById("origin").value;
  window.open(origin_link,"_blank");
}

function shorten_jump(){
  console.log("Jump to shorten_link!")
  var shorten_link = document.getElementById("shorten").value;
  window.open(shorten_link,"_blank");
}

function origin_copy(){
  let label = document.getElementById("origin");
  label.select();
  document.execCommand("Copy");
  new bootstrap.Toast(document.querySelector('#origin_copy_toast')).show();
  console.log("Origin link copied!");
}

function shorten_copy(){
  let label = document.getElementById("shorten");
  label.select();
  document.execCommand("Copy");
  new bootstrap.Toast(document.querySelector('shorten_copy_toast')).show();
  console.log("Shor link copied!");
}